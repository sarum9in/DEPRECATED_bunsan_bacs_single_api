package bacs.single.api.pb.settings;

import "resource.proto";

message TestGroupSettings
{
    required Run run = 1;
    required ProcessSettings process = 2;
}

message Run
{
    enum Order
    {
        NUMERIC = 0;         ///< Non-numeric tests will be removed from test_set.
        LEXICOGRAPHICAL = 1;
    }
    enum Algorithm
    {
        ALL = 0;             ///< Test group is OK in any case.
        WHILE_NOT_FAIL = 1;  ///< Test group is OK only if every test is OK.
    }
    required Order order = 1;
    required Algorithm algorithm = 2;
}

message ProcessSettings
{
    required ResourceLimits resource_limits = 1;
    repeated File files = 2;
    required Execution execution = 3;
}

message Execution
{
    message Redirection
    {
        enum Stream
        {
            STDIN = 0;
            STDOUT = 1;
            STDERR = 2;
        }
        required Stream stream = 1;
        required string file_id = 2;
    }
    repeated string arguments = 1;
    optional Path current_path = 2;
    repeated Redirection redirections = 3;
}

/// Filesystem path.
message Path
{
    /// If specified, path is absolute, otherwise -- relative.
    optional string root = 1;
    /// Path elements, will be concatenated using OS-specific delimiter.
    repeated string elements = 2;
}

message File
{
    enum Permissions
    {
        READ = 0;
        WRITE = 1;
        EXECUTE = 2;
    }

    /*!
     * \note: It may be more convenient to declare Offset class.
     * Range is looped, i.e. {begin = 5, end = 2}
     * for file of length 7 "0123456" will return "5601".
     */
    message Range
    {
        /// Offset: positive from the beginning, negative from the end (inclusive).
        optional int64 begin = 1;
        /// Offset: positive from the beginning, negative from the end (exclusive).
        optional int64 end = 2;
    }
    required string id = 1;
    repeated Permissions permissions = 2;
    optional /*DataId*/string init = 3;
    optional Path path = 4;
    optional Range receive = 5;
}
